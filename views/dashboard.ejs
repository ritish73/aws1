<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel="stylesheet" href="/stylesheets/dashboard_css.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css">
    <link rel="shortcut icon" type="image/x-icon" href="/images/final_2.png">
    
    <title>Dashboard</title>
</head>
<body>

    <style>
        #messagebox{
            background-color: #ab2d24;
            padding-left: 20px;
        }
    </style>
    <% if(successmessage){ %>
        <h2 id="messagebox"><%=successmessage%></h2>
    <% } %>
    
  
    <input type="checkbox" id="sidebar-toggle">
    <div class="sidebar">

        <div class="sidebar-header">
            <h3 class="brand">
              
                <span>BACKBENCHERS</span>
            </h3>
            <label for="sidebar-toggle" class="ti-menu-alt"></label>
        </div>
        
        <div class="sidebar-menu">
            <ul>
                <li>
                    <a href="/">
                        <span class="ti-home"></span>
                        <span>Home</span>
                    </a>
                </li>

                <li>
                    <a href="/aboutus">
                        <span class="ti-face-smile"></span>
                        <span>About us</span>
                    </a>
                </li>

                <li>
                    <a href="/contactus">
                        <span class="ti-mobile"></span>
                        <span>Contact us</span>
                    </a>
                </li>

                <li>
                    <a href="/blogs">
                        <span class="ti-book"></span>
                        <span>Blogs</span>
                    </a>
                </li>

                <li>
                    <a href="/logout">
                        <span class="ti-settings"></span>
                        <span>logout</span>
                    </a>
                </li>

                <% if(currentUser.role === 'admin'){ %>
                <li>
                    <a href="/adminportal">
                        <span class="ti-settings"></span>
                        <span>adminportal</span>
                    </a>
                </li>
               <% } %>
                    
            </ul>
        </div>
    </div>

        <div class="main-content">

            <header>
                <div class="search-wrapper">
                    <img class="personal-img" src="/images/final_2.png" alt="" height="40px" width="40px">
                </div>
                <p><%=message%></p>
                <div class="social-icons">

                    <!-- <span class="ti-bell"></span>
                    <span class="ti-comment"></span> -->
                    <span class="name-dash"><a href="/dashboard">logged in as <%=currentUser.username%></a></span>
                    <div></div>
                </div>
            </header>

            <main>

                <h2 class="dash-title">Overview</h2>

                <div class="dash-cards">

                    <div class="card-single">
                        <div class="card-body">
                            <span class="ti-write"></span>
                            <div>
                                <h5>Total number of Blogs</h5>
                                <h4><%=articlesCount%></h4>
                            </div> 
                        </div>
                        <div class="card-footer">
                            <a href="/showAllArticles?page=1">View all</a>
                        </div>
                    </div>

                    <div class="card-single">
                        <div class="card-body">
                            <span class="ti-plus"></span>
                            <div>
                                <h5>Total subscribers</h5>
                                <h4><%=followersCount%></h4>
                            </div> 
                        </div>
                        <div class="card-footer">
                            <!-- <a href="/showAllFollowers">View all</a> -->
                        </div>
                    </div>

                    <div class="card-single">
                        <div class="card-body">
                            <span class="ti-eye"></span>
                            <div>
                                <h5>Total number of likes</h5>
                                <h4><%=totalLikes%></h4>
                            </div> 
                        </div>
                        <div class="card-footer">
                            <!-- <a href="">View all</a> -->
                        </div>
                    </div>

                </div>

                <section class="recent">
                    <div class="activity-grid">
                      <div class="activity-card">
                        <h3 class="heading-top" id="ending">PERSONAL INFO</h3>

                        <form action="/updateUser" method="POST" class="sign-in-form">


                            <!-- <h2 class="title">Personal info</h2> -->
                            <h3>Username</h3>
                            <div class="input-field">
                                <i class="fas fa-user"></i>
                            <input type="text" name="username" value="<%=currentUser.username%>" required >
                            </div>

                            <h3>Channel name</h3>
                            <div class="input-field">
                                <i class="fas fa-user"></i>
                            <input type="text" name="fullName" value="<%=currentUser.fullName%>" required>
                            </div>

                            <h3>Email address</h3>
                            <div class="input-field">
                                <i class="fas fa-envelope"></i>
                            <input type="text" name="email" value="<%=currentUser.email%>" required>
                            </div>
        
                            <h3>Password</h3>
                            <div class="input-field">
                                <!-- <i class="fas fa-lock"></i>
                            <input type="password" value="<%=currentUser.fullName%>"> -->

                            <span class="R-button"><a href="/forgot">Reset password</a></span>
                           
                            </div>

                            <h3>Gender</h3>
                            <select name="gender" class="option" required>
                                <i class="fas fa-user-tie"></i>
                                <option selected="selected"><%=currentUser.gender%></option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Others">Others</option>
                                </select> 
        
                            <h3>Year of Birth</h3>
                            <div class="input-field">
                                <i class="fas fa-lock"></i>
                            <input type="date" placeholder="Date of birth" name = "dob" value="<%=getdob%>" required>
                            </div>

                            <!-- <h3>Country</h3>
                            <div class="input-field">
                                <i class="fas fa-lock"></i>
                            <input type="text" name="" id="">
                           
                            </div> -->
                            
                            <h3>Profession</h3>
                            <select name="profession" class="option" id="" required>
                            <i class="fas fa-user-tie"></i>
                            <option disabled="disabled" selected="selected" value=""><%=currentUser.profession%></option>
                            <option value="Self earning">Self earning</option>
                            <option value="Student">Student</option>
                            <option value="Others">Others</option>
                            </select>  
                            
                            <div class="input-field">
                                <i class="fas fa-lock"></i>
                                <button class="update-info" type="submit">Update info</button>
                            
                            </div>

                        </form>

                        <h3 class="heading-top">DELETE MY ACCOUNT</h3>
                        <div class="delete-account">
                            <h4>
                                If you wish to delete your account, all of your data 
                                will be permanently deleted. You will not be able to restore 
                                it once you continue to delete your account. In case you want to 
                                reactivate your account, kindly mail us at
                                teambackbenchers@gmail.com within 45 days from the date of deletion of your account.
                            </h4>
                            <button onclick="deleteAccount(this)" class="delete-button">Delete my account</button>
                        </div>
                    </div>

                    <div class="summary">
                        <div class="summary-card">
                            <div class="summary-single">
                                <span class="ti-name"></span>
                                <div>
                                    <h5><%=currentUser.fullName%></h5>
                                    <small>Channel name</small>
                                </div>
                            </div>

                            <div class="summary-single">
                                <span class="ti-file"></span>
                                <div>
                                    <h5><a href="/showSavedArticles?page=1"><%=savedArticlesCount%></a></h5>
                                    <small>Saved for later posts</small>
                                </div>
                            </div>

                            <div class="summary-single">
                                <span class="ti-share"></span>
                                <div>
                                    <h5><a href="/showSharedArticles?page=1"><%=sharedArticlesCount%></a></h5>
                                    <small>No. of post shared</small>
                                </div>
                            </div>
                        </div>

                        <div class="birthday-card">
                            <div class="bday-info">
                                <h5>Publish your Blog</h5>
                                <div>
                                  <a href="/publish">
                                    <button>
                                        <span>
                                            click here
                                        </span>
                                    </button>
                                  </a>
                                </div>
                            </div>
                        </div>
                        <div class="image-dash">
                            <img class="dash-image-person" src="/images/97 (2) - Copy.png" alt="" height="600px" width="270px">
                        
                        </div>


                    </div>                    
                    </div>
                </section>



            </main>
        </div>

</body>

<script>
var httpRequest;
function deleteAccount(e){
    
    httpRequest = new XMLHttpRequest();
    if (!httpRequest) {
        alert('Giving up :( Cannot create an XMLHTTP instance');
        return false;
    }
    httpRequest.onreadystatechange = deleteAccountRequest;
    httpRequest.open('GET', '/delete');        
    httpRequest.send();   
    
}

function deleteAccountRequest(){
    if (httpRequest.readyState === XMLHttpRequest.DONE) {
        if (httpRequest.status === 200) {
            // let respJson = JSON.parse(httpRequest.responseText);
            window.location = '/logout';
        } else {
            alert('There was a problem with the request.');
        }
    }
}

</script>
    
</html>