<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheets/fontawesome-free-5.15.1-web/css/all.css">
    <link rel="stylesheet" href="/stylesheets/business-economics.css">
    <title>Blogs</title>
    <link rel="shortcut icon" type="image/x-icon" href="/images/final_2.png">
</head>
<body>

    <!-- <div class="bg-pic-background">
        <img src="images/sameer_3draft.jpeg" alt="background">
    </div> -->
    <style>
    #messagebox{
        background-color: #ab2d24; 
    }
    </style>
    <div id="md"><h2 id="messagebox"></h2></div>
    
    
    <header>
        
    <div class="top-horiz-bar">
        <div class="logo-section-in-bar">
            
            <a href="/"><img class="top-img-logo" src="/images/final_2.png" alt="logo-pic" height="60px" width="60px"></a>
            <!-- <img class="top-name-logo" src="./zoomed-brand-name.png" alt="logo-name" height="80px" width="130px"> -->
            <a href="/"><img class="top-img2-logo" src="/images/5.png" alt="logo-pic" height="60rem" width="145rem"></a>
            
        </div>


        <div class="other-icons">
        <form method="get" action="/posts/business-economics">
            <div class="search-box">
                
                <input id="search-font" class="search-txt" type="text" name="search" placeholder="Type to search">
                <button class="search-btn">
                    <i class="fas fa-search"></i>
                </button>
            
            </div>
        </form>
        
        <div class="person-account">
            <span class="account-info">
                <% if(currentUser){ %>
                    <a href="/dashboard" class="finall"> <%=currentUser.username%></a>
                <% } else { %>
                    <a href="/register_or_login" class="finall"> Sign-in/up</a>
                <% } %>
            </span>
        </div>
        </div>

        </div>


<div class="vertical-nav-bar">
    <a href="/">Home<span><i class="fas fa-home"></i></span></a>
    <a href="/blogs">Blogs<span><i class="fas fa-user-graduate"></i></span></a>
    <a href="/publish">Write Here<span><i class="fas fa-pencil-alt"></i></span></a>
    <a href="/contactus">Contact US<span><i class="fas fa-phone-alt"></i></span></a>
    <a href="/aboutus">About Us<span><i class="fas fa-users"></i></span></a>
    <a href="https://www.facebook.com/BackBenchers-105240558097832">Facebook<span><i class="fab fa-facebook-f"></i></span></a>
    <a href="https://www.instagram.com/the.back_benchers_/?igshid=1tkr1g17rzrf5">Instagram<span><i class="fab fa-instagram"></i></span></a>
    <a href="https://www.linkedin.com/in/back-benchers-94a049202/">Linkedin<span><i class="fab fa-linkedin-in"></i></span></a>

    
   
</div>
</header>

<main>

    <div class="all-engineering-articles">
        <div class="table-all">
            <% for(var i=start; i<=limit; i+=2) { %>
        <!-- <div class="row"> -->

            <% if(i<=posts.length-1){ %>
                <% if(posts[i] !== null && posts[i].isReviewedByAdmin === true){ %>
           

        <div class="column">
            <div class="blog-post">
            <div class="blog-post__img">
            <img src="/uploads/img/posts/<%=posts[i].imagename%>" alt="<%=posts[i].imagename%>" class="blog-post__article-img">
            </div>
            <div class="blog-post__info">
            <div class="blog-post__date">
                <span><%= posts[i].publishDay%></span>
                <span><%= posts[i].publish_date %></span>
            </div>
            <div class="author-name">
                <ul class="author-content">
                    <button onclick="addFollower(this)" getauthor="<%= posts[i].authorName %>" > <li class="name-aut"><%= posts[i].authorName %>></li></button>
                    <button onclick="saveToLater(this)" getpost="<%=posts[i].slug%>" > <li class="save-to-later"><i class="fas fa-plus "></i></li></button>
                </ul>
            </div>
            <h1 class="blog-post__title"><%=posts[i].title%></h1>
            <p class="blog-post__text"><%= posts[i].content.substring(0,120) %>...</p>
            <% if(currentUser && currentUser.role === "admin"){ %>
                <form method="POST" action="/updateRecommended/<%=posts[i].slug%>/<%=posts[i].subject%>/<%=page%>">
                    <span>push to recommended at what position: </span><input type="number" name="position">
                    <button type="submit">push</button>
                </form>
                <div><button onclick="deletePost(this)" getpost="<%=posts[i].slug%>" >delete post</button></div>
            <% } %>
            <a href="/posts/<%=posts[i].subject%>/<%=posts[i].slug%>" class="blog-post__cta">Read more</a>
            <ul class="btns-on-blogcard">
                <!-- <li class="btns-blog"><i class="far fa-eye fa-2x "></i></li> -->
                <button onclick="like(this)" getpost="<%=posts[i].slug%>" ><li class="btns-blog"><i class="far fa-hand-peace fa-2x "></i><span onclick="count(this)" class="count" id="likecount" ><%=posts[i].likes%></span></li></button>
                <a href="https://api.whatsapp.com/send?text=<%=hostname%>/posts/<%=posts[i].subject%>/<%= posts[i].slug %>" data-action="share/whatsapp/share" target="_blank"><button onclick="sharePost(this)" getpost="<%=posts[i].slug%>" ><li class="btns-blog"><i class="fas fa-share fa-2x "></i><span class="count" id="sharecount"><%=posts[i].shares%></span></li></button></a>
         
                <span></span>
            </ul>
            </div>
            </div>
            </div>
            <% } %>
            <% } %>



            <% if( i+1 <= posts.length-1 ){ %>
                <% if(posts[i+1] !== null && posts[i+1].isReviewedByAdmin === true){ %>
            <div class="column">
                <div class="blog-post">
                <div class="blog-post__img">
                <img src="/uploads/img/posts/<%=posts[i+1].imagename%>" alt="<%=posts[i+1].imagename%>" class="blog-post__article-img">
                </div>
                <div class="blog-post__info">
                <div class="blog-post__date">
                    <span><%= posts[i+1].publishDay%></span>
                    <span><%= posts[i+1].publish_date %></span>
                </div>
                <div class="author-name">
                    <ul class="author-content">
                        <button onclick="addFollower(this)" getauthor="<%= posts[i+1].authorName %>" > <li class="name-aut"><%= posts[i+1].authorName %>></li></button>
                        <button onclick="saveToLater(this)" getpost="<%=posts[i+1].slug%>" > <li class="save-to-later"><i class="fas fa-plus "></i></li></button>
                    </ul>
                </div>
                <h1 class="blog-post__title"><%=posts[i+1].title%></h1>
                <p class="blog-post__text"><%= posts[i+1].content.substring(0,10) %>...</p>
                <% if(currentUser && currentUser.role == "admin"){ %>
                    <form method="POST" action="/updateRecommended/<%=posts[i+1].slug%>/<%=posts[i+1].subject%>/<%=page%>">
                        <span>push to recommended at what position: </span><input type="number" name="position">
                        <button type="submit">push</button>
                    </form>
                    <div><button onclick="deletePost(this)" getpost="<%=posts[i+1].slug%>">delete post</button></div>
                <% } %>
                <a href="/posts/<%=posts[i+1].subject%>/<%=posts[i+1].slug%>" class="blog-post__cta">Read more</a>
                <ul class="btns-on-blogcard">
                    <!-- <li class="btns-blog"><i class="far fa-eye fa-2x "></i></li> -->
                    <button onclick="like(this)" getpost="<%=posts[i+1].slug%>" ><li class="btns-blog"><i class="far fa-hand-peace fa-2x "></i><span class="count" id="likecount"><%=posts[i+1].likes%></span></li></button>
                <a href="https://api.whatsapp.com/send?text=<%=hostname%>/posts/<%=posts[i+1].subject%>/<%= posts[i+1].slug %>" data-action="share/whatsapp/share" target="_blank"><button onclick="sharePost(this)" getpost="<%=posts[i+1].slug%>" ><li class="btns-blog"><i class="fas fa-share fa-2x "></i><span class="count" id="sharecount"><%=posts[i+1].shares%></span></li></button></a>
                    <span></span>
                </ul>
                </div>
                </div>
                </div>
                <% } %>
            <% } %>
           
            <% } %>

        

        <!-- </div> -->

        </div>


        </div>


            <!-- <div class="page-end">
                &nbsp;
            </div> -->

            <div class="next-page">
                <% if(shownextbutton === true){ %>
                <h2 class="new-page-blogs">-Page <%=page%>- <span class="next-page-btn"><a href="/showSharedArticles?page=<%=nextpage%>">Next page</a></span></h2>
                <% } else{ %>
                    <h2 class="new-page-blogs">-Page <%=page%>-</h2>
                <% } %>
            </div>
        </div>
        </section> 

    </main>
        

    


        <footer>
            <div class="main-content">
                <div class="left box">
                    <div class="content">
                        <div class="logo-footer-img">
                        <img src="/images/2.png" alt="logo" height="250px" width="250px">
                    </div>
                        <div class="social">
                            <a href="https://www.facebook.com/BackBenchers-105240558097832"><span class="fab fa-facebook-f"></span></a>
                        <a href="https://www.instagram.com/the.back_benchers_/?igshid=1tkr1g17rzrf5"><span class="fab fa-instagram"></span></a>
                        <a href="https://www.linkedin.com/in/back-benchers-94a049202/"><span class="fab fa-linkedin-in"></span></a>
                        </div>
                    </div>
                </div>

                <div class="center box">
                    <h2>Quick links</h2>
                    <div class="content">
                        <ul class="links">
                            <li><a href="/"> > Home</a></li>
                            <li><a href="/posts/business-economics?page=1"> > Business & Economics</a></li>
                            <li><a href="/posts/commerce?page=1"> > Commerce</a></li>
                            <li><a href="/posts/engineering?page=1"> > Engineering</a></li>
                            <li><a href="/posts/personality-development?page=1"> > Personality Devlopment</a></li>
                        </ul>
                    </div>
                </div>

                <div class="center-right box">
                    <h2>Company</h2>
                    <div class="content">
                        <ul class="links">
                            <li><a href="/aboutus"> > About Us</a></li>
                            <li><a href="#" id="cu"> > Contact Us</a></li>
                            <li><a href="/termsandconditions"> > Terms and conditions</a></li>
                            <li><a href="/privacypolicy"> > Privacy Policy</a></li>
                        </ul>
                    </div>
                </div>

                

                <div class="right box">
                    <h2>Any queries ?</h2>
                    <div class="content">
                        <form action="/query/submit/personality-development/<%=page%>" method="POST">
                            <div class="email">
                                <div class="text">Email *</div>
                                <input type="email" name="email" required>
                            </div>
                            <div class="msg">
                                <div class="text">Message *</div>
                                <textarea  cols="25" rows="2" name="message"></textarea>
                            </div>
                            <div class="btn">
                                <button type="submit">Send</button>
                            </div>
                        </form>
                    </div>
                </div>


            </div>

            <div class="bottom">
                <center>
                    <span class="credits">Created by <a href="#">Backbenchers</a> | </span>
                    <span class="far fa-copyright"></span><span> 2020 All rights reserved.</span>
                </center>
            </div>
        </footer>


</body>



<script>  
    var httpRequest;     
    var currentUser;
    var messagebox = document.getElementById('messagebox')
    function findUser(){
        httpRequest = new XMLHttpRequest();
        httpRequest.onreadystatechange = findUserRequest;
        httpRequest.open('GET', '/findUser');        
        httpRequest.send();
    }
    window.onload = findUser();

    
    function findUserRequest(){
        
        if (httpRequest.readyState === XMLHttpRequest.DONE) {
            if (httpRequest.status === 200 ) {
                var resJson = JSON.parse(httpRequest.responseText)
                currentUser = resJson.CurrentUser;
                console.log(currentUser)
                if(currentUser === undefined){
                    console.log("no one is logged in");
                } else {
                    console.log('user found!!')
                }
                
            } else {
            alert('There was a problem with the request.');
            }
        }
    }
 
        function saveLaterRequest(){
        
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status === 200 ) {
                    var resJson = JSON.parse(httpRequest.responseText)
                    console.log(resJson.message);
                    messagebox.innerText = resJson.message;
                } else {
                alert('There was a problem with the request.');
                }
            }
        }


        async function addFollowerRequest(){
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status === 200 ) {
                    var resJson = JSON.parse(httpRequest.responseText)
                    console.log(resJson.message);
                    messagebox.innerText = resJson.message;
                } else {
                alert('There was a problem with the request.');
                }
            }
        }



        function deletePostRequest(){
        
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status === 200 ) {
                    
                    console.log('post deleted')
                } else {
                alert('There was a problem with the request.');
                }
            }
        }


        function sharePostRequest(){
        
        if (httpRequest.readyState === XMLHttpRequest.DONE) {
            if (httpRequest.status === 200 ) {       
                    var resJson = JSON.parse(httpRequest.responseText)
                    document.getElementById('sharecount').innerHTML = resJson.value;
                } else {
                    alert('There was a problem with the request.');
                }
            }
        }
    
          
       function saveToLater(e){
         
         var curPostSlug = e.getAttribute('getpost');    
         console.log("curpostslug " + curPostSlug)
         if(currentUser){
             httpRequest = new XMLHttpRequest();
         if (!httpRequest) {
           alert('Giving up :( Cannot create an XMLHTTP instance');
           return false;
         }
         httpRequest.onreadystatechange = saveLaterRequest;
         httpRequest.open('GET', '/savetolater/' + curPostSlug);        
         httpRequest.send();
       } else {
           console.log("you need to login to save this post")
       }
     }   

     function deletePost(e){
        var curPostSlug = e.getAttribute('getpost');   
        if(currentUser){
            httpRequest = new XMLHttpRequest();
            if (!httpRequest) {
            alert('Giving up :( Cannot create an XMLHTTP instance');
            return false;
            }
            httpRequest.onreadystatechange = deletePostRequest;
            httpRequest.open('GET', '/posts/delete/' + curPostSlug);        
            httpRequest.send();
       } else {
           console.log("you need to login to save this post")
       }
    }

    async function addFollower(e){
        if(currentUser){
            var authname = await e.getAttribute('getauthor');
            console.log("authname : ", authname);
            httpRequest = new XMLHttpRequest();
            if(!httpRequest){
                alert('Giving up :( Cannot create an XMLHTTP instance')
                return false;
            }
            httpRequest.onreadystatechange = addFollowerRequest;
            httpRequest.open('GET', '/addfollower/' +authname);
            httpRequest.send();
        } else {
            console.log("you need to login to follow an author")
            var message = "you need to login first to follow an author"
            window.location = '/register_or_login/?message='+message;
        }
    }

    async function sharePost(e){
        if(currentUser){
            var curPostSlug = e.getAttribute('getpost');  
            
            httpRequest = new XMLHttpRequest();
            if(!httpRequest){
                alert('Giving up :( Cannot create an XMLHTTP instance')
                return false;
            }
            httpRequest.onreadystatechange = sharePostRequest;
            httpRequest.open('GET', '/sharePost/' +curPostSlug);
            httpRequest.send();
        } else {
            console.log("you need to login to share this post")
        }
    }



    function like(e){
        
        if(currentUser){
            var curPostSlug = e.getAttribute('getpost');  
            httpRequest = new XMLHttpRequest();
            if (!httpRequest) {
              alert('Giving up :( Cannot create an XMLHTTP instance');
              return false;
            }
            httpRequest.onreadystatechange = likeRequest;
            httpRequest.open('GET', '/posts/liked/' + curPostSlug);        
            httpRequest.send();
          
          }
         else {
          document.querySelector("#message").innerHTML = "you need to log in to like this post";
        }
      }

      function likeRequest(){
          if (httpRequest.readyState === XMLHttpRequest.DONE) {
            if (httpRequest.status === 200) {
              var respJson = JSON.parse(httpRequest.responseText)
              console.log(respJson)
              messagebox.innerText = respJson.message;
            } else {
              alert('There was a problem with the request.');
            }
          }
        }




 </script>



</html>